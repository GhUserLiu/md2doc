# 项目结构优化说明

## 优化概述

项目已完成模块化重构，采用标准的Python包结构，提高了代码的可维护性和可扩展性。

## 新的项目结构

```
md2doc/
├── src/                          # 源代码目录
│   └── md2doc/                   # 主包
│       ├── __init__.py           # 包初始化，导出主要类
│       ├── __main__.py           # 模块入口（支持 python -m md2doc）
│       ├── config.py             # 配置模块 - 定义所有格式规范
│       ├── converter.py          # 核心转换器类
│       ├── formatter.py          # 格式化工具 - Word文档格式设置
│       ├── parser.py             # 解析器 - Markdown解析和处理
│       └── cli.py                # 命令行工具
├── tests/                        # 测试目录
│   └── test_converter.py         # 单元测试
├── docs/                         # 文档目录
│   ├── 新版格式规范说明.md
│   ├── 完整格式规范.md
│   ├── 字体格式说明.md
│   ├── 问题修复说明.md
│   ├── 第二次修复说明.md
│   ├── 横线移除说明.md
│   ├── 首行缩进修复说明.md
│   ├── 落款右对齐说明.md
│   └── 项目结构说明.md（本文件）
├── input/                        # 输入文件夹
│   ├── 示例.md
│   └── 测试文档.md
├── output/                       # 输出文件夹
├── md2doc.py                     # 启动脚本
├── convert.py                    # 旧版工具（保留兼容性）
├── generate_summary.py           # 固定格式生成器（保留）
├── README.md                     # 项目说明文档
├── requirements.txt              # 依赖列表
└── .gitignore                    # Git忽略文件
```

## 核心模块说明

### 1. config.py - 配置模块

**职责**：定义所有格式规范和常量

**主要类**：
- `FontConfig`: 字体配置（名称、大小、粗体、斜体）
- `MarginConfig`: 页边距配置
- `ParagraphConfig`: 段落配置
- `ConverterConfig`: 转换器主配置类

**特点**：
- 集中管理所有格式规范
- 支持自定义配置
- 符合GB/T 9704-2012标准

### 2. formatter.py - 格式化工具

**职责**：处理Word文档的格式设置

**主要函数**：
- `set_font()`: 设置中文字体（包括eastAsia属性）
- `set_paragraph_spacing()`: 设置段落格式和行距
- `set_page_margins()`: 设置页边距
- `remove_paragraph_border()`: 移除段落边框
- `is_signature_line()`: 判断是否是落款行

**特点**：
- 直接操作Word XML元素
- 支持固定值行距
- 完整的中文字体支持

### 3. parser.py - 解析器模块

**职责**：解析和处理Markdown内容

**主要函数**：
- `parse_inline_formatting()`: 解析行内格式（加粗、斜体）
- `extract_title_from_md()`: 提取文档标题
- `sanitize_filename()`: 清理文件名
- `normalize_list_symbol()`: 统一列表符号

**特点**：
- 支持嵌套格式
- 智能标题提取
- 文件名安全处理

### 4. converter.py - 核心转换器

**职责**：Markdown转Word的核心转换逻辑

**主要类**：
- `MarkdownConverter`: 主转换器类

**主要方法**：
- `convert()`: 主转换方法
- `_setup_page_layout()`: 设置页面布局
- `_add_document_title()`: 添加文档标题
- `_parse_content()`: 解析内容
- `_process_heading[1-3]()`: 处理各级标题
- `_process_paragraph()`: 处理段落
- `_process_list_item()`: 处理列表
- `_process_quote()`: 处理引用

**特点**：
- 面向对象设计
- 清晰的职责划分
- 易于扩展和维护

### 5. cli.py - 命令行工具

**职责**：提供命令行接口

**主要功能**：
- 批量转换
- 单文件转换
- 日志记录
- 进度显示

**命令行参数**：
```
-i, --input     输入文件夹
-o, --output    输出文件夹
-f, --file      转换单个文件
-l, --log       日志文件
-v, --verbose   详细日志
```

### 6. __init__.py - 包初始化

**导出内容**：
```python
from .converter import MarkdownConverter
from .config import ConverterConfig

__all__ = ['MarkdownConverter', 'ConverterConfig']
```

## 使用方式

### 方式1：使用启动脚本（推荐）

```bash
python md2doc.py
```

### 方式2：作为模块使用

```bash
set PYTHONPATH=src
python -m md2doc
```

### 方式3：作为Python库使用

```python
from md2doc import MarkdownConverter

converter = MarkdownConverter()
doc, title = converter.convert(Path('input/document.md'))
doc.save(f'output/{title}.docx')
```

### 方式4：使用旧版工具（兼容）

```bash
python convert.py
```

## 优势对比

### 优化前

```
❌ 单文件convert.py（500+行）
❌ 功能耦合严重
❌ 难以维护和扩展
❌ 无法作为库使用
❌ 缺少单元测试
```

### 优化后

```
✅ 模块化设计（6个模块）
✅ 职责清晰分离
✅ 易于维护和扩展
✅ 可作为Python库使用
✅ 包含单元测试
✅ 符合Python包规范
```

## 测试

运行单元测试：

```bash
python tests/test_converter.py
```

测试覆盖：
- ✅ 解析器功能测试
- ✅ 格式化功能测试
- ✅ 配置测试
- ✅ 集成测试

## 兼容性

保留了旧版工具以确保向后兼容：
- `convert.py`: 旧版单文件工具
- `generate_summary.py`: 固定格式生成器

## 扩展性

新架构支持以下扩展：

1. **添加新的Markdown语法支持**
   - 在`parser.py`中添加新的解析函数
   - 在`converter.py`中添加处理方法

2. **自定义格式规范**
   - 创建自定义配置类
   - 传递给MarkdownConverter

3. **添加输出格式支持**
   - 创建新的转换器类
   - 实现统一的接口

4. **添加更多测试**
   - 在`tests/`目录添加测试文件

## 版本信息

- 当前版本：2.0.0
- 发布日期：2026年1月5日
- 重构类型：模块化重构

## 总结

本次项目结构优化：

1. ✅ **提高了代码质量**：从单文件500+行拆分为多个模块
2. ✅ **增强了可维护性**：职责清晰，易于定位问题
3. ✅ **提升了可扩展性**：支持自定义配置和新功能
4. ✅ **改善了可用性**：可作为库使用，提供多种使用方式
5. ✅ **保证了兼容性**：保留旧版工具，平滑迁移
6. ✅ **增加了测试**：包含完整的单元测试

项目现在更加专业、规范，符合Python最佳实践！
