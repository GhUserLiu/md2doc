# md2doc 打包指南

本文档说明如何将md2doc项目打包为独立的可执行文件。

## 📦 打包方式

### 方式一：使用批处理脚本（推荐）

双击运行 `打包.bat`，脚本会自动：
1. 检查虚拟环境
2. 安装PyInstaller（如果未安装）
3. 清理旧的打包文件
4. 执行打包
5. 提示可执行文件位置

### 方式二：手动打包

```bash
# 1. 激活虚拟环境
venv\Scripts\activate

# 2. 安装打包依赖
pip install -r requirements-build.txt

# 3. 执行打包
pyinstaller build.spec

# 或者直接使用命令行
pyinstaller --onefile --name md2doc md2doc.py
```

## 📁 打包输出

打包完成后，可执行文件位于：
```
dist/md2doc.exe
```

## 🚀 使用可执行文件

### 基本用法

```bash
# 转换所有Markdown文件为Word
md2doc.exe

# 转换并导出PDF
md2doc.exe -p

# 转换指定文件
md2doc.exe -f input\文档.md

# 查看帮助
md2doc.exe --help
```

### 与可执行文件一起分发

将以下文件夹结构打包分发：
```
md2doc/
├── md2doc.exe          # 可执行文件
├── input/              # 输入文件夹（用户放置MD文件）
└── output/             # 输出文件夹（自动生成）
```

## ⚙️ 打包配置说明

`build.spec` 文件包含打包配置：

- **name**: 可执行文件名称（md2doc）
- **console**: 是否显示控制台窗口（True）
- **onefile**: 打包为单个文件（通过EXE实现）
- **hiddenimports**: 隐藏导入模块列表
- **excludes**: 排除不需要的模块以减小体积

## 🔧 常见问题

### 1. 打包后文件很大

**原因**: PyInstaller会将Python解释器和所有依赖打包进去。

**解决**:
- 使用 `--exclude-module` 排除不需要的模块
- 考虑使用虚拟环境打包（只安装必要依赖）

### 2. 运行时提示缺少模块

**解决**: 在 `build.spec` 的 `hiddenimports` 中添加缺失的模块

### 3. 杀毒软件误报

**原因**: PyInstaller打包的程序可能被杀毒软件误认为病毒。

**解决**:
- 添加数字签名
- 在杀毒软件中添加白名单
- 使用UPX压缩时可能需要设置 `upx=False`

### 4. PDF转换失败

**原因**: `docx2pdf` 依赖Windows COM组件，需要安装Microsoft Word。

**解决**:
- 确保目标机器安装了Microsoft Word
- 或使用在线PDF转换服务

## 📊 文件大小参考

- **原始Python脚本**: 几KB
- **打包后可执行文件**: 约15-30MB（包含Python运行时）
- **安装后体积**: 约50-80MB（解压后）

## 🎯 发布建议

### 方式一：单文件发布
- 只发布 `md2doc.exe`
- 用户需要自行创建 `input/` 和 `output/` 文件夹

### 方式二：完整包发布
```
md2doc-release/
├── md2doc.exe
├── input/
│   └── 示例.md
├── README.md
└── 使用说明.txt
```

### 方式三：安装程序
使用NSIS或Inno Setup创建安装程序

## 📝 版本信息

可在打包时添加版本号：
```bash
pyinstaller --name "md2doc v1.0" build.spec
```

或在代码中添加版本号显示：
```python
# md2doc.py
__version__ = "1.0.0"
```
